(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/editCard/main"],{"01c8":function(t,n,e){"use strict";e.r(n);var o=e("2cbd"),a=e("b3cb");for(var i in a)"default"!==i&&function(t){e.d(n,t,(function(){return a[t]}))}(i);e("80ef");var c,r=e("f0c5"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);n["default"]=s.exports},"2cbd":function(t,n,e){"use strict";var o,a=function(){var t=this,n=t.$createElement;t._self._c;t._isMounted||(t.e0=function(n){t.showTextarea=!1},t.e1=function(n){t.showTextarea=!0})},i=[];e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){return o}))},"5e06":function(t,n,e){},"80ef":function(t,n,e){"use strict";var o=e("5e06"),a=e.n(o);a.a},a8c0:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=c(e("a34a")),a=c(e("ed08")),i=c(e("b775"));function c(t){return t&&t.__esModule?t:{default:t}}function r(t,n,e,o,a,i,c){try{var r=t[i](c),s=r.value}catch(d){return void e(d)}r.done?n(s):Promise.resolve(s).then(o,a)}function s(t){return function(){var n=this,e=arguments;return new Promise((function(o,a){var i=t.apply(n,e);function c(t){r(i,o,a,c,s,"next",t)}function s(t){r(i,o,a,c,s,"throw",t)}c(void 0)}))}}var d=function(){e.e("components/bottom_button_small").then(function(){return resolve(e("881f"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("components/card_1").then(function(){return resolve(e("1fbe"))}.bind(null,e)).catch(e.oe)},l=function(){e.e("components/card_2").then(function(){return resolve(e("61ac"))}.bind(null,e)).catch(e.oe)},h=function(){e.e("components/card_3").then(function(){return resolve(e("0f39"))}.bind(null,e)).catch(e.oe)},f=function(){e.e("components/card_4").then(function(){return resolve(e("75d6"))}.bind(null,e)).catch(e.oe)},m=wx.createInnerAudioContext(),p=wx.getRecorderManager(),g=(wx.getSystemInfoSync().platform,wx.getSystemInfoSync().SDKVersion,{name:"",components:{BottomButtonSmall:d,Card_1:u,Card_2:l,Card_3:h,Card_4:f},data:function(){return{audioArr:{bl:!1,time:0,id:0},begin_time:0,end_time:0,diff_time:0,now_get_auth:!1,userlogo:"https://yyker-one-stand.oss-cn-beijing.aliyuncs.com/yimai_photos/user/user_default_avatar_square.png",intro:"",card_style:0,changeing:!1,showPageStatus:"1",top_height:["524rpx","820rpx","458rpx","456rpx"],card_msg:{picchecked:"",username:"",tel:"",wx:"",company_wx:"",email:"",post:"",company:"",companyId:0,company_logo:""},self_photos:[],type:"add",cardId:0,showTextarea:!1,selfCompany:{},isLoading:!1,self_video:[]}},watch:{intro:function(t,n){t.length>120&&(this.intro=this.intro.slice(0,120))}},onLoad:function(){this.$root.$mp.query.type&&"edit"==this.$root.$mp.query.type?(this.type="edit",this.getMyCard(),wx.setNavigationBarTitle({title:"编辑名片"})):(this.type="add",wx.setNavigationBarTitle({title:"添加名片"}),this.card_msg={picchecked:"",username:"",tel:"",wx:"",company_wx:"",email:"",post:"",company:"",companyId:0,company_logo:""},this.self_photos=[],this.getSelfCompany())},onShow:function(){if("1"===this.showPageStatus){console.log("执行了onshow事件");var t=wx.getStorageSync("choose_company")||"",n=wx.getStorageSync("choose_company_id")||"",e=wx.getStorageSync("choose_company_logo")||"";this.$set(this.card_msg,"company",t),this.$set(this.card_msg,"companyId",n),this.$set(this.card_msg,"company_logo",e),this.now_get_auth=wx.getStorageSync("now_get_auth")||!1}},onUnload:function(){m.stop(),this.showPageStatus="1"},methods:{goPage:function(){0!==this.self_video.length?wx.navigateTo({url:"../videoExhibition/main"}):wx.navigateTo({url:"../editVideoExhibition/main?type=create"})},getSelfCompany:function(){var t=this;i.default.POST({ignore:!0},"","/businessCard/getCompanyId").then((function(n){n&&(t.selfCompany=n||{},t.$set(t.card_msg,"company",n.companyName),t.$set(t.card_msg,"companyId",n.companyId),t.$set(t.card_msg,"company_logo",n.companyLogo))}))},stop:function(t){t.stopPropagation()},getMyCard:function(){var t=this;wx.showLoading(),i.default.POST({},"","/businessCard/getUserCard").then((function(n){wx.hideLoading(),n?(n.soundRecording&&(t.audioArr={bl:!1,time:n.soundTime,id:1,src:n.soundRecording}),t.card_msg={companyId:n.companyId,picchecked:n.logo||"",username:n.name||"",tel:n.phone||"",wx:n.personalWx||"",company_wx:n.companyWx||"",email:n.email||"",post:n.position||"",company:n.companyName,company_logo:n.companyLogo,cardId:n.cardId},t.cardId=n.cardId,t.card_style=n.style,t.self_photos="暂无"==n.photo?[]:n.photo.split(","),t.self_video=n.videoList||[],t.intro=n.briefIntroduction||"",wx.setStorageSync("choose_company",t.card_msg.company),wx.setStorageSync("choose_company_id",t.card_msg.companyId),wx.setStorageSync("choose_company_logo",t.card_msg.company_logo)):t.type="add"})).catch((function(t){wx.hideLoading()}))},audioPlay:function(t){if(m=wx.createInnerAudioContext(),m.obeyMuteSwitch=!1,this.audioArr.id){var n=this,e=(t.currentTarget.dataset.id,t.currentTarget.dataset.key,n.audioArr),o=e.src;m.src=o,m.autoplay=!0,e.bl=!0,m.onPlay((function(){n.audioArr=e})),m.onEnded((function(){e.bl=!1,n.audioArr=e}))}else wx.showToast({title:"您还没有录音！",duration:2e3,icon:"none"})},audioStop:function(t){var n=this,e=(t.currentTarget.dataset.key,n.audioArr);e.bl=!1,m.stop(),m.onStop((function(){e.bl=!1,n.audioArr=e})),m.onEnded((function(){e.bl=!1,n.audioArr=e}))},onGotUserInfo:function(t){var n=t.mp.detail;this.audioArr.bl=!1,n.encryptedData?(this.now_get_auth=!0,wx.setStorageSync("now_get_auth",!0)):wx.showToast({title:"您已取消授权！",duration:2e3,icon:"none"}),n=null},record_begin:function(){var t=this;m.stop(),t.audioArr.bl=!0,p.start({format:"mp3"}),t.begin_time=+new Date,p.onError((function(){console.log("失败-----")})),p.onStop((function(n){t.now_get_auth?i.default.UploadImage(n.tempFilePath).then((function(n){wx.hideLoading(),n=JSON.parse(n),"200"==n.code?(wx.showToast({title:"恭喜!录音成功",icon:"success",duration:1e3}),t.end_time=+new Date,t.diff_time=t.end_time-t.begin_time,t.diff_time=Math.ceil(.001*t.diff_time),t.audioArr={id:"1",src:i.default.imgBackUrl+n.data,bl:!1,time:t.diff_time}):(wx.showToast({title:"录音失败，请重试！",icon:"none",duration:1e3}),t.audioArr={id:"0",src:"",bl:!1,time:0})})).catch((function(n){wx.hideLoading(),t.audioArr={id:"0",src:"",bl:!1,time:0},console.log("err -- ",n)})):t.now_get_auth=!0}))},record_end:function(){p.stop(),this.audioArr.bl=!1},uploadpic:function(){var t=s(o.default.mark((function t(n,e){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!("self"==n&&this.self_photos.length>=9)){t.next=3;break}return wx.showToast({title:"最多选择九张！",duration:1500,icon:"none"}),t.abrupt("return");case 3:return this.showPageStatus="0",t.next=6,a.default.chooseImage("file",e);case 6:if(i=t.sent,i instanceof Array){t.next=9;break}return t.abrupt("return");case 9:this.uploadImgFun(i,0,n);case 10:case"end":return t.stop()}}),t,this)})));function n(n,e){return t.apply(this,arguments)}return n}(),uploadImgFun:function(){var t=s(o.default.mark((function t(n){var e,a,i=arguments;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=i.length>1&&void 0!==i[1]?i[1]:0,a=i.length>2?i[2]:void 0,t.next=4,this.uploadImg(n[e],a);case 4:e<n.length-1&&this.uploadImgFun(n,e+1,a);case 5:case"end":return t.stop()}}),t,this)})));function n(n){return t.apply(this,arguments)}return n}(),uploadImg:function(t,n){var e=this,o=this;return wx.showLoading({mask:!0}),i.default.UploadImage(t).then((function(t){wx.hideLoading(),t=JSON.parse(t),"200"==t.code?"user"==n?(console.log("头像上传",t),o.card_msg.picchecked="".concat(i.default.imgBackUrl).concat(t.data)):"self"==n&&e.self_photos.push("".concat(i.default.imgBackUrl).concat(t.data)):wx.showToast({title:"网络异常",duration:2e3,icon:"none"})})).catch((function(t){wx.hideLoading(),console.log("err -- ",t)}))},btn_tap:function(){var t=this;if(!this.isLoading){var n=this,e="";if(m.stop(),n.card_msg.username)if(n.card_msg.tel&&a.default.checkPhone(n.card_msg.tel))if(n.card_msg.company||"add"!=this.type){var o=n.self_photos.join(","),c="",r="";"add"==this.type?(e="/businessCard/createCard",c=n.card_msg.companyId):e="/businessCard/updateCard",r=n.card_msg.post,this.isLoading=!0,wx.showLoading();var s={style:n.card_style,companyId:c,name:n.card_msg.username,phone:n.card_msg.tel,logo:n.card_msg.picchecked,personalWx:n.card_msg.wx,companyWx:n.card_msg.company_wx,photo:o,position:r,soundRecording:n.audioArr.src,soundTime:n.audioArr.time,email:n.card_msg.email,briefIntroduction:n.intro,cardId:n.cardId};i.default.POST(s,"",e).then((function(n){wx.hideLoading(),t.isLoading=!1,n&&(wx.showToast({title:"保存成功",duration:2e3,icon:"none"}),wx.setStorageSync("refreshCard",!0),setTimeout((function(){wx.navigateBack()}),500))})).catch((function(n){wx.hideLoading(),t.isLoading=!1,wx.showToast({title:n.message,duration:2e3,icon:"none"})})).catch((function(){t.isLoading=!1}))}else wx.showToast({title:"请选择公司！",duration:2e3,icon:"none"});else wx.showToast({title:"请输入正确的电话！",duration:2e3,icon:"none"});else wx.showToast({title:"请输入姓名！",duration:2e3,icon:"none"})}},card_style_change:function(t){var n=this;wx.showLoading(),this.changeing=!0,this.card_style=t,setTimeout((function(){n.changeing=!1,wx.hideLoading()}),500)},chooseCompany:function(){this.selfCompany.companyId?wx.showToast({title:"如需更换校园，请先退出当前校园，再重新创建名片",duration:2e3,icon:"none"}):this.card_msg.cardId?wx.showToast({title:"禁止修改",icon:"none",duration:2e3}):this.page_turn("searchChooseItem","company")},page_turn:function(t,n){wx.navigateTo({url:"../"+t+"/main?type="+n})},delImg:function(t){wx.showLoading(),this.self_photos.splice(t,1),wx.hideLoading()}}});n.default=g},b3cb:function(t,n,e){"use strict";e.r(n);var o=e("a8c0"),a=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(n,t,(function(){return o[t]}))}(i);n["default"]=a.a},b8f5:function(t,n,e){"use strict";(function(t){e("6cdc"),e("921b");o(e("66fd"));var n=o(e("01c8"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])}},[["b8f5","common/runtime","common/vendor"]]]);