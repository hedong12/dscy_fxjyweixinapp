(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/dynamicDetail/main"],{"2ec3":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=u(n("a34a")),o=u(n("b775")),a=u(n("ed08")),r=n("2f62"),c=n("ee73"),s=u(n("0f88"));function u(t){return t&&t.__esModule?t:{default:t}}function d(t,e,n,i,o,a,r){try{var c=t[a](r),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(i,o)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function r(t){d(a,i,o,r,c,"next",t)}function c(t){d(a,i,o,r,c,"throw",t)}r(void 0)}))}}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(n,!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var p=function(){n.e("components/bottom_button_small").then(function(){return resolve(n("881f"))}.bind(null,n)).catch(n.oe)},w=function(){Promise.all([n.e("common/vendor"),n.e("components/LoginIntercept")]).then(function(){return resolve(n("f887"))}.bind(null,n)).catch(n.oe)},g=/(((^https?:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+(?::\d+)?|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)$/,v=function(t){return g.test(t)},y={components:{BottomButtonSmall:p,LoginIntercept:w},computed:h({},(0,r.mapGetters)(["currentCompany"]),{},(0,r.mapState)({isLogin:function(t){return t.isLoginStatus}})),watch:{isLogin:{immediate:!0,handler:function(t){t&&(this.isShowMore=!0)}}},data:function(){return{webViewSrc:"",dynamicId:98,addTypeShow:!1,addTypes:[{name:"删除",id:"delete"},{name:"取消",id:"cancel"}],title:"",companyName:"",time:"",details:"",photos:[],isShowShare:!1,isCollect:!1,isPreviewImg:!1,maskImg:"",openStatus:!1,isShowMore:!0,cardId:""}},onShareAppMessage:function(t){var e=this,n=this.currentCompany,i=n.companyId,o=n.cardId;this.addDynamicForwardRecord(o,this.dynamicId);var a=o+""+(new Date).getTime();(0,c.addShareRecord)(i,4,this.dynamicId,a).then((function(t){console.log("添加一条记录",e.dynamicId,"uuid",a,e.photos[0],e.title)}),(function(t){}));var r="/pages/dynamicDetail/main?dynamicId="+this.dynamicId+"&companyId="+i+"&cardId="+o+"&goType=1&shareId="+a;return{imageUrl:this.photos[0],title:this.title,path:r,success:function(t){wx.showShareMenu({withShareTicket:!0})},fail:function(t){console.log("失败-- ",t)}}},onLoad:function(){var t=l(i.default.mark((function t(e){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.dynamicId=this.$root.$mp.query.dynamicId,this.COMPANYID=this.$root.$mp.query.companyId||wx.getStorageSync("COMPANYID")||"",n=e.cardId,this.cardId=e.cardId,t.next=6,this.getInits(n);case 6:return t.next=8,this.checkCollect();case 8:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),methods:{loginInterceptSuccess:function(){var t=l(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.webViewSrc?this.isShowMore=!0:this.goPage();case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showShare:function(){this.isShowShare=!0},collect:function(){var t=this;wx.showLoading();var e="",n={};e=this.isCollect?"/personal/delCollection":"/personal/addCollection",n={itemType:2,itemId:this.dynamicId},o.default.changeCollect(n,e).then((function(e){e&&(t.isCollect=!t.isCollect),wx.hideLoading()})).catch((function(t){wx.hideLoading()}))},getInits:function(){var t=l(i.default.mark((function t(e){var n,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this,wx.showLoading(),t.prev=2,t.next=5,o.default.POST({companyId:n.COMPANYID,dynamicId:n.dynamicId,cardId:wx.getStorageSync("CARDID")||e},"","/personal/getDynamicInfo");case 5:r=t.sent,wx.hideLoading(),console.log(r),r&&r.length>0&&(r=r[0],v(r.details)?this.webViewSrc=r.details:this.details=r.details,this.title=r.title||"",this.companyName=r.companyName,this.time=a.default.getdate(r.createTime,"dateTime"),this.photos=r.photos.split(",")),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),console.log("err---------or",t.t0);case 14:case"end":return t.stop()}}),t,this,[[2,11]])})));function e(e){return t.apply(this,arguments)}return e}(),toLogin:function(){var t=l(i.default.mark((function t(e){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e>3)){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,s.default.postLoginPromiseByTourists();case 5:t.next=11;break;case 7:return t.prev=7,t.t0=t["catch"](2),t.next=11,this.toLogin(++e);case 11:case"end":return t.stop()}}),t,this,[[2,7]])})));function e(e){return t.apply(this,arguments)}return e}(),saveImg:function(){var t=this,e=this.maskImg;wx.getImageInfo({src:e,success:function(e){wx.saveImageToPhotosAlbum({filePath:e.path,success:function(e){wx.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff",animation:{duration:1}}),t.isPreviewImg=!1,wx.showToast({title:"保存成功",duration:1e3,icon:"success",mask:!0})},fail:function(e){wx.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff",animation:{duration:1}}),t.isPreviewImg=!1,wx.showToast({title:"保存失败",duration:1e3,icon:"none",mask:!0})}})}})},onShareEvent:function(){var e=l(i.default.mark((function e(){var n=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return wx.showLoading({title:"生成海报中",mask:!0}),e.next=3,o.default.POST({companyId:this.COMPANYID,shareType:4,itmeId:this.dynamicId},"","/shareRecord/addShareRecord").then((function(e){o.default.POST({itmeId:n.dynamicId,shardRecordId:e},"","/personal/getDynamicPoster").then((function(t){n.maskImg=t,n.isPreviewImg=!0,wx.hideLoading()})).catch((function(e){t.showToast({title:"生成分享图片失败",icon:"none"}),wx.hideLoading()}))})).catch((function(e){t.showToast({title:"生成分享图片失败",icon:"none"}),wx.hideLoading()}));case 3:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),checkCollect:function(){var t=this;o.default.checkCollect({itemType:2,itemId:this.dynamicId}).then((function(e){t.isCollect=e.status})).catch((function(t){}))},goPage:function(){t.navigateTo({url:"./webView?url=".concat(this.webViewSrc)})},choose_tap:function(t){"cancel"!==t?(wx.showLoading(),o.default.POST({dynamicId:this.dynamicId},"","/company/delDynamicInfo").then((function(t){wx.hideLoading(),wx.showToast({title:"成功！",icon:"success"}),setTimeout((function(){wx.navigateBack()}),600)})).catch((function(t){console.log(t),wx.hideLoading()}))):this.addTypeShow=!1}}};e.default=y}).call(this,n("543d")["default"])},"46d0":function(t,e,n){"use strict";var i,o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){e.stopPropagation(),t.isShowShare=!1},t.e1=function(e){e.stopPropagation(),t.isShowShare=!1},t.e2=function(e){t.isPreviewImg=!1})},a=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}))},"57b0":function(t,e,n){"use strict";n.r(e);var i=n("46d0"),o=n("d115");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("8a85");var r,c=n("f0c5"),s=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=s.exports},"8a85":function(t,e,n){"use strict";var i=n("e6fe"),o=n.n(i);o.a},d115:function(t,e,n){"use strict";n.r(e);var i=n("2ec3"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},e6fe:function(t,e,n){},f214:function(t,e,n){"use strict";(function(t){n("6cdc"),n("921b");i(n("66fd"));var e=i(n("57b0"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["f214","common/runtime","common/vendor"]]]);