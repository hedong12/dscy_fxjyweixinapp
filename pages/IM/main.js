(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/IM/main"],{2643:function(e,t,n){"use strict";n.r(t);var o=n("82a4"),s=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=s.a},"6a8c":function(e,t,n){"use strict";(function(e){n("6cdc"),n("921b");o(n("66fd"));var t=o(n("72c2"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"72c2":function(e,t,n){"use strict";n.r(t);var o=n("e916"),s=n("2643");for(var i in s)"default"!==i&&function(e){n.d(t,e,(function(){return s[e]}))}(i);n("7840");var a,r=n("f0c5"),c=Object(r["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=c.exports},7840:function(e,t,n){"use strict";var o=n("faed"),s=n.n(o);s.a},"82a4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("a34a")),s=r(n("b2eb")),i=(r(n("4360")),n("2f62")),a=r(n("b775"));function r(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t,n,o,s,i,a){try{var r=e[i](a),c=r.value}catch(u){return void n(u)}r.done?t(c):Promise.resolve(c).then(o,s)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(o,s){var i=e.apply(t,n);function a(e){h(i,o,s,a,r,"next",e)}function r(e){h(i,o,s,a,r,"throw",e)}a(void 0)}))}}var p=function(){n.e("components/editInputer").then(function(){return resolve(n("4dcd"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/addWxCourse").then(function(){return resolve(n("786f"))}.bind(null,n)).catch(n.oe)},g=wx.getRecorderManager(),m=wx.createInnerAudioContext(),w=!1,v=null,x={name:"",components:{EditInputer:p,AddWxCourse:f},data:function(){return{input_word:"",pageFixed:"",socket:null,messageCont:{},logo:"",myid:"",userlogo:"",sendId:"",times:[],indexs:{},params:{},priceObj:{},wxCode:"",phone:"",myPhone:"",seedName:"",isShowCourse:!1,appHeight:0,chatHeight:0,isShow:!1,titleLists:[{title:"你好，请问有智能名片的产品相关介绍文档吗？"},{title:"你好，请问智能名片都有什么套餐，价格是怎么样的？"},{title:"你好，请问有智能名片的产品相关介绍文档吗？"},{title:"你好，我想和贵公司合作，具体怎么操作呢？"}],wechatQrCode:JSON.parse(wx.getStorageSync("CURRENT_COMPANY")).companyEenterprise,isInput:!0,isMore:!1,urls:"",isPadding:"",phrases:!1,text:"按住 说话",showQC:!1}},onUnload:function(){wx.setStorageSync("sendId",""),this.isShow=!1,m.stop()},mounted:function(){this.logo=wx.getStorageSync("avatarUrl")||"",this.myid=wx.getStorageSync("userId")||"";var e=wx.getSystemInfoSync();-1!==e.model.indexOf("iPhone X")&&(this.isPadding="40rpx")},onShow:function(){var e=this;this.isShow=!0;var t=this.$root.$mp.query,n=t.type,o=t.specId,i=t.userId,a=t.cardId,r=t.logo,c=t.wxCode,u=t.phone,d=t.name,h=t.showQC;console.log(this.$root.$mp.query),this.appHeight=wx.getSystemInfoSync().windowHeight,this.wxCode=c||"",this.phone=u||"",this.isInput=!0,this.isMore=!1,this.phrases=!1,this.urls="",this.userlogo=r||"",this.seedName=d||"",this.sendId=i||"",this.myPhone=wx.getStorageSync("phone")||"",this.showQC=h||!1,wx.setStorageSync("sendId",i);var l={code:105,type:n,specId:o,clientNum:0,pageSize:20,cardId:a,targetId:i};this.params=l,s.default.getChatRecord(l),wx.setNavigationBarTitle({title:e.$root.$mp.query.name}),this.getCommonPhrases(),this.generateQC(this.showQC)},onPullDownRefresh:function(){var e=l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.params.clientNum=this.msgCont.data.length,s.default.getChatRecord(this.params),setTimeout((function(){wx.stopPullDownRefresh()}),3e3);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:u({},(0,i.mapActions)(["add","change"]),{},(0,i.mapMutations)(["setPhone"]),{generateQC:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t=this,n=wx.createCanvasContext("myCanvas");wx.downloadFile({url:"https://yyker-one-stand.oss-cn-beijing.aliyuncs.com/yimai_photos/user/qc_bg.png",success:function(e){n.drawImage(e.tempFilePath,0,0,203,229),n.draw(!0);var o="扫描进群";n.setFontSize(17),n.setFillStyle("#333333"),n.fillText(o,.5*(203-n.measureText(o).width),202),n.draw(!0),wx.downloadFile({url:t.wechatQrCode,success:function(e){n.drawImage(e.tempFilePath,16,23,169,159),n.draw(!0,(function(){console.log("canvasToTempFilePath"),wx.canvasToTempFilePath({x:0,y:0,width:203,height:229,destWidth:203,destHeight:229,canvasId:"myCanvas",success:function(e){console.log("This is SHow"),t.wechatQrCode=e.tempFilePath}})}))}})}})}},moreIconEvent:function(){this.phrases&&(this.phrases=!1),this.isMore=!this.isMore},clickPhrasesEvent:function(){this.phrases=!this.phrases},previewImg:function(e){wx.previewImage({urls:[e]})},clickPhotoEvent:function(){var e=this;wx.chooseImage({sourceType:["album"],sizeType:["compressed"],success:function(t){console.log(t),e.uploadImgFun(t.tempFilePaths,0,2)}})},uploadImgFun:function(){var e=l(o.default.mark((function e(t){var n,s,i=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,s=i.length>2?i[2]:void 0,wx.showLoading({title:"上传中",mask:!0}),e.next=5,this.uploadFiles(t[n],s);case 5:n<t.length-1&&this.uploadImgFun(t,n+1,s);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),clickShotEvent:function(){var e=this;wx.chooseImage({sourceType:["camera"],sizeType:["compressed"],count:1,success:function(t){e.uploadFiles(t.tempFilePaths[0],2)}})},clickVideoEvent:function(){var e=this;wx.chooseVideo({compressed:!0,maxDuration:60,success:function(t){e.uploadFiles(t.tempFilePath,4)}})},audioPlay:function(e,t){var n=this;this.urls!==e?(this.urls=e,m.src=e,m.play(),m.onEnded((function(){n.urls=""})),m.onError((function(e){n.urls="",wx.showToast({title:"系统错误",duration:2e3,icon:"none"})}))):(this.urls="",m.stop())},touchStartEvent:function(){this.text="松开 结束",wx.getSetting({success:function(e){e.authSetting["scope.record"]?(g.start({duration:6e4}),g.onError((function(e){wx.showToast({title:"录音失败，请重试",duration:2e3,icon:"none"})})),g.onStart((function(){w=!0,v=Date.now(),wx.showToast({title:"录音开始",duration:6e4,icon:"none"})}))):wx.authorize({scope:"scope.record",success:function(e){console.log(e)},fail:function(e){wx.showToast({title:"请先授权录音权限",duration:2e3,icon:"none"})}})}})},touchEndEvent:function(){var e=this;this.text="按住 说话",setTimeout((function(){w&&(w=!1,g.stop(),g.onStop((function(t){wx.hideToast(),Date.now()-v<1e3?wx.showToast({title:"录音时间太短",duration:2e3,icon:"none"}):e.uploadFiles(t.tempFilePath,3)})))}),500)},uploadFiles:function(){var e=l(o.default.mark((function e(t,n){var i=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return 4===n&&wx.showLoading({title:"上传中",mask:!0}),e.abrupt("return",a.default.UploadImage(t).then((function(e){e=JSON.parse(e),wx.hideLoading(),200==e.code&&s.default.sendMessage({code:103,message:a.default.imgBackUrl+e.data,messageType:1,contentType:n,targetId:i.$root.$mp.query.userId})})).catch((function(e){return console.log(e)})));case 2:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}(),contactMe:function(){s.default.sendMessage({code:103,message:this.myPhone,messageType:4,targetId:this.$root.$mp.query.userId})},getCommonPhrases:function(){var e=this;a.default.POST({cardId:this.$root.$mp.query.cardId,type:1},"","/personal/selectUserCommonList").then((function(t){e.titleLists=t?t.map((function(e){return{title:e.text}})):[{title:"你好，请问有智能名片的产品相关介绍文档吗？"},{title:"你好，请问智能名片都有什么套餐，价格是怎么样的？"},{title:"你好，请问有智能名片的产品相关介绍文档吗？"},{title:"你好，我想和贵公司合作，具体怎么操作呢？"}]}))},getPhoneNumber:function(e){var t=this;console.log(e);var n=e.target,o=n.encryptedData,s=n.iv;o&&s?a.default.POST({phoneData:e.target.encryptedData,phoneIv:e.target.iv},"","/home/getWxPhone").then((function(e){wx.setStorageSync("phone",e),t.setPhone(e),t.myPhone=e,t.contactMe()})):wx.showToast({title:"手机号未授权，请绑定手机号后再次发送",icon:"none",duration:2e3})},toGoodsDetail:function(e){var t=e.goodsId,n=e.parentId,o=e.specId;wx.navigateTo({url:"/pages/prodDetail/main?goodId=".concat(t,"&parentId=").concat(n,"&specId=").concat(o)})},getTime:function(){var e={};if(this.msgCont.data){var t=this.msgCont.data.map((function(t,n){return 3==t.messageType&&(e[n]=t.message.price?t.message.price/100:0),t.time})),n={};n[0]=this.dateF(t[0]);for(var o=1;o<t.length;o++){var s=(t[o]-t[o-1])/1e3/60;s>3&&(n[o]=this.dateF(t[o]))}this.$set(this,"indexs",n),this.$set(this,"priceObj",e)}},dateF:function(e){var t=new Date(e).getFullYear(),n=new Date(e).getMonth()+1,o=new Date(e).getDate(),s=new Date(e).getHours()-10<0?"0"+new Date(e).getHours():new Date(e).getHours(),i=new Date(e).getMinutes()-10<0?"0"+new Date(e).getMinutes():new Date(e).getMinutes(),a=(new Date(e).getSeconds()-10<0?new Date(e).getSeconds():new Date(e).getSeconds(),new Date),r=a.getFullYear(),c=a.getMonth()+1,u=a.getDate(),d="";return d=t===r&&n===c&&o===u?s+":"+i:n+"月"+o+" "+s+":"+i,d},getcomment:function(e){if(e.trim()){var t=this;s.default.sendMessage({code:103,message:e,messageType:1,targetId:t.$root.$mp.query.userId}),this.change()}},addWx:function(){if(this.wxCode){var e=this;wx.setClipboardData({data:this.wxCode,success:function(t){wx.getClipboardData({success:function(t){e.pageFixed=!0,e.isShowCourse=!0,setTimeout((function(){e.pageFixed=!1}),2e3)}})}})}else wx.showToast({title:"未绑定微信号",icon:"none",duration:2e3})},makePhone:function(){this.phone?wx.makePhoneCall({phoneNumber:this.phone}):wx.showToast({title:"未绑定手机号",icon:"none",duration:2e3})},page_turn:function(e,t){"WebSite"!==e?wx.switchTab({url:"../"+e+"/main"}):wx.navigateTo({url:"../"+e+"/main"})}}),watch:{msgCont:{handler:function(){this.getTime(),this.$nextTick((function(){wx.pageScrollTo({scrollTop:999999999})}))},deep:!0}},computed:u({},(0,i.mapGetters)(["msgCont","currentCompany","changePosition"]))};t.default=x},e916:function(e,t,n){"use strict";var o,s=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.isMore=!1},e.e1=function(t){e.phrases=!1},e.e2=function(t){e.isInput=!1},e.e3=function(t){e.isInput=!0},e.e4=function(t){e.isMore=e.phrases=!1},e.e5=function(t){e.isShowCourse=!1})},i=[];n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}))},faed:function(e,t,n){}},[["6a8c","common/runtime","common/vendor"]]]);